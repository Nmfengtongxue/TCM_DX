class LocalPrescriptionDB{constructor(){this.dbName="prescriptionRecords",this.initDB()}initDB(){localStorage.getItem(this.dbName)||localStorage.setItem(this.dbName,JSON.stringify([]))}getAllRecords(){return JSON.parse(localStorage.getItem(this.dbName))||[]}saveRecord(e){var t=this.getAllRecords();return e.id||(e.id=`presc_${Date.now()}_`+Math.floor(1e3*Math.random())),e.createTime||(e.createTime=(new Date).toISOString()),e.payTime||(e.payTime=(new Date).toISOString()),t.push(e),localStorage.setItem(this.dbName,JSON.stringify(t)),e}getRecordById(t){return this.getAllRecords().find(e=>e.id===t)}updateRecord(t,e){var r=this.getAllRecords(),a=r.findIndex(e=>e.id===t);return-1!==a?(r[a]={...r[a],...e,updatedAt:(new Date).toISOString()},localStorage.setItem(this.dbName,JSON.stringify(r)),r[a]):null}deleteRecord(t){var e=this.getAllRecords(),r=e.filter(e=>e.id!==t);return r.length!==e.length&&(localStorage.setItem(this.dbName,JSON.stringify(r)),!0)}getRecordsByDateRange(e,t){var r=this.getAllRecords();let a=new Date(e),o=new Date(t);return o.setHours(23,59,59,999),r.filter(e=>{e=new Date(e.payTime);return e>=a&&e<=o})}getTodayRecords(){var e=(new Date).toISOString().split("T")[0];return this.getRecordsByDateRange(e,e)}getStatsByDateRange(e,t){e=this.getRecordsByDateRange(e,t);return{count:e.length,totalAmount:e.reduce((e,t)=>e+Number(t.totalAmount),0).toFixed(2),records:e}}getTodayStats(){var e=(new Date).toISOString().split("T")[0];return this.getStatsByDateRange(e,e)}clearAllRecords(){localStorage.setItem(this.dbName,JSON.stringify([]))}exportAsJson(){var e=this.getAllRecords(),e=JSON.stringify(e,null,2),e=new Blob([e],{type:"application/json"}),e=URL.createObjectURL(e),t=document.createElement("a");t.href=e,t.download=`prescription_records_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e)}importFromJson(e){try{var t,r=JSON.parse(e);return Array.isArray(r)?(t=[...this.getAllRecords(),...r],localStorage.setItem(this.dbName,JSON.stringify(t)),!0):!1}catch(e){return console.error("导入JSON失败:",e),!1}}}let localDB=new LocalPrescriptionDB;export default localDB;export{LocalPrescriptionDB};